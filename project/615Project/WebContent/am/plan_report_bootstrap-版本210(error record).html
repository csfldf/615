<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>

<div class="container-fluid" ms-important="planReport">
    <form ms-attr-id="$formId" class="form-horizontal" >
        <fieldset>
            <div class="row-fluid">
                <div class="span6">
                    <div class="control-group"><!-- Select Basic -->
                        <label class="control-label">工作所属: (PlanCategory)</label>
                        <div class="controls">
                            <select ms-duplex="report.planCategory" name="planCategory" class="input-xlarge" required>
                                <option value="1">Enter</option>
                                <option value="2">default</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span6">
                    <div class="control-group"><!-- Text input-->
                        <label class="control-label">综合任务编号: (Plan N.O)</label>

                        <div class="controls">
                            <input ms-duplex="report.planSerialNumber" name="planSerialNumber" type="text"
                                   class="input-xlarge" autofocus required>
                        </div>
                    </div>
                </div>
                <div class="span6">
                    <div class="control-group"><!-- Text input-->
                        <label class="control-label ">综合任务代码: (PlanCode)</label>

                        <div class="controls">
                            <input ms-duplex="report.planCode" name="planCode" type="text" class="input-xlarge"
                                   required>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span6">
                    <div class="control-group"><!-- Text input-->
                        <label class="control-label ">工作名称: (PlanName)</label>
                        <div class="controls">
                            <input ms-duplex="report.planName" name="planName" type="text" class="input-xlarge"
                                   required>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span6">
                    <div class="control-group"><!-- Text input-->
                        <label class="control-label ">工作下达日期:(IssuedDate)</label>

                        <div class="controls">
                            <input ms-duplex="report.planIssuedDate" name="planIssuedDate" type="date"
                                   class="input-xlarge" required>
                        </div>
                    </div>
                </div>
                <div class="span6">
                    <div class="control-group"><!-- Text input-->
                        <label class="control-label ">工作启动日期:(StartDate)</label>

                        <div class="controls">
                            <input ms-duplex="report.planStartDate" name="planStartDate" type="date"
                                   class="input-xlarge" required>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span6">
                    <div class="control-group"><!-- Text input-->
                        <label class="control-label ">工作要求完成日期:(Deadline)</label>

                        <div class="controls">
                            <input ms-duplex="report.planDeadlineDate" name="planDeadlineDate" type="date"
                                   class="input-xlarge" required>
                        </div>
                    </div>
                </div>
                <div class="span6">
                    <div class="control-group"><!-- Prepended text-->
                        <label class="control-label">距离完成日期: (RemainingDate)</label>

                        <div class="controls">
                            <div class="input-prepend input-append"><span class="add-on">{{planRemainingDate>=0?'还剩余':'已超期'}}</span>
                                <span class="uneditable-input span2">{{planRemainingDate>=0?planRemainingDate:planRemainingDate*(-1)}}</span>
                                <span class="add-on">天</span></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span6">
                    <div class="control-group"><!-- Text input-->
                        <label class="control-label ">工作来源: (PlanSource)</label>

                        <div class="controls">
                            <input ms-duplex="report.planSource" name="planSource" type="text" class="input-xlarge"
                                   required>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span8">
                    <div class="control-group"><!-- Text input-->
                        <label class="control-label ">工作输出物: (PlanOutput)</label>
                        <div class="controls">
                            <!-- Fine Uploader DOM Element-->
                            <div id="bootstrapped-fine-uploader"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span6">
                    <div class="control-group"><!-- Text input-->
                        <label class="control-label ">工作责任人: (WorkLeader)</label>
                        <div class="controls">
                            <div class="input-append">
                                <input ms-duplex="report.planController" name="planController" type="text" required>
                                <a href="#personModal" role="button" class="inline btn" data-toggle="modal">Select</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="span6">
                    <div class="control-group"><!-- Select Basic -->
                        <label class="control-label ">工作状态: (PlanState)</label>

                        <div class="controls">
                            <select ms-duplex="report.planState" name="planState" class="input-xlarge" required>
                                <option ms-repeat="$planStateTmpl" ms-value="el.value">{{el.text}}</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <div class="control-group"><!-- Textarea -->
                        <label class="control-label ">更新说明: (UpdateDescription)</label>

                        <div class="controls">
                            <textarea ms-duplex="report.planUpdateDescription" name="planUpdateDescription" type="text"
                                      rows="5" class="span8"> </textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <div class="controls-row form-actions"><!-- Button -->
                        <a ms-click="save(false)" type="button" class="btn btn-primary input-large">Submit</a>
                        <a ms-click="save(true)" type="button" class="btn btn-info input-medium">SaveDraft</a>
                        <a type="button" class="btn btn-danger">Delete</a>
                        <!--<input type="reset" class="btn" value="Clear">-->
                    </div>
                </div>
            </div>
            <div class="alert alert-danger alert-dismissable">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                <strong>注意!</strong> 本站查询的分数来源于12333官网，详情请到官网咨询
            </div>
        </fieldset>
    </form>
</div>

<script src="../js/avalon.js"></script>
<link rel="stylesheet" href="../css/base/bootstrap.css">
<script src="../js/globalConfig.js"></script>
<script src="../js/base/jquery-1.11.1.js"></script>
<script>
    require(['jquery','am.planReportManager','bootstrap'], function ($,prM) {
        var report=prM._newVm('1234');
        $('[ms-important]').attr('ms-important','planReport'+report.$reportId);
        avalon.scan()
    })

   // require(['jquery','fineuploader'],function($){
        /**
         * 保证id在MainFrame上的唯一性
         */
        $(document).ready(function(){
        random=(new Date()).getTime();
        $("#bootstrapped-fine-uploader").attr('id',"bootstrapped-fine-uploader"+random);//fineuploader
        $fileuploader_tmpl=$("#qq-template-bootstrap");
        $fileuploader_tmpl.text()//.replace('triggerUpload','triggerUpload'+random)
        $fileuploader_tmpl.html(newtmpl);//fineuploader-tmpl
        $("#qq-template-bootstrap").attr('id',"qq-template-bootstrap"+random);
        $("#personModal").attr('id',"personModal"+random);//personModal
        $("[href=#personModal]").attr('href',"#personModal"+random);

        var uploader = $("#bootstrapped-fine-uploader"+random).fineUploader({
            element: $('#bootstrapped-fine-uploader'+random),
            request: {
                endpoint: 'server/handleUploads'
            },
            template: $('#qq-template-bootstrap'+random),
            classes: {
                success: 'alert alert-success',
                fail: 'alert alert-error'
            },
            validation:{
                //allowedExtensions: ['jpeg', 'jpg', 'txt'],
                itemLimit:50,
                sizeLimit: 50*1024*1024 // 50 kB = 50 * 1024 bytes
            },
            showMessage: function(message) {
                // Using Bootstrap's classes
                $('#bootstrapped-fine-uploader'+random).append('<div class="alert alert-error">' + message + '</div>');
            },
            debug:true,
            deleteFile: {
                enabled: true, // defaults to false
                endpoint: '/my/delete/endpoint'
            },
            autoUpload: false,
            editFilename: {                                            //编辑名字
                enable: true
            }

        }).on('complete', function(event, id, fileName, responseJSON) {
            if (responseJSON.success) {
                $(this).append('<img src="img/success.jpg" alt="' + fileName + '">');
            }});

        $('#triggerUpload'+random).click(function() {
            uploader.fineUploader('uploadStoredFiles');
        })
        ;
        })
   // })

</script>
<!-- Fine Uploader template====================================================================== -->
<script type="text/template" id="qq-template-bootstrap">
    <div class="qq-uploader-selector qq-uploader span12">
        <div class="qq-upload-drop-area-selector qq-upload-drop-area span12" qq-hide-dropzone>
            <span>Drop files here to upload</span>
        </div>
        <div class="qq-upload-button-selector qq-upload-button btn btn-success" style="width: auto;">
            <div><i class="icon-upload icon-white"></i> Add Files...</div>
        </div>
        <div id="triggerUpload" class="btn btn-warning">
            <i class="icon-upload icon-white"></i> Upload now
        </div>

    <span class="qq-drop-processing-selector qq-drop-processing">
      <span>Processing dropped files...</span>
      <span class="qq-drop-processing-spinner-selector qq-drop-processing-spinner"></span>
    </span>
        <ul class="qq-upload-list-selector qq-upload-list" style="margin-top: 10px; text-align: center;">
            <li>
                <div class="qq-progress-bar-container-selector">
                    <div class="qq-progress-bar-selector qq-progress-bar"></div>
                </div>
                <span class="qq-upload-spinner-selector qq-upload-spinner"></span>
                <span class="qq-edit-filename-icon-selector qq-edit-filename-icon"></span>
                <span class="qq-upload-file-selector qq-upload-file"></span>
                <input class="qq-edit-filename-selector qq-edit-filename" tabindex="0" type="text">
                <span class="qq-upload-size-selector qq-upload-size"></span>
                <a class="qq-upload-cancel-selector qq-upload-cancel" href="#">Cancel</a>
                <a class="qq-upload-retry-selector qq-upload-retry" href="#">Retry</a>
                <a class="qq-upload-delete-selector qq-upload-delete" href="#">Delete</a>
                <span class="qq-upload-status-text-selector qq-upload-status-text"></span>
            </li>
        </ul>
    </div>
</script>
<!-- Employee Select Modal -->
<div id="personModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="myModalLabel">Modal header</h3>
    </div>
    <div class="modal-body">
        <p>One fine body…</p>
        <div ms-controller="test" ms-widget="simplegrid" style="width:99%"></div>
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
        <button class="btn btn-primary">Save changes</button>
    </div>
</div>

</body>
</html>
<!--
2014.10.12:fix:点击button ms-click未绑定。<button标签会自动提交，使用type="buton"
-->